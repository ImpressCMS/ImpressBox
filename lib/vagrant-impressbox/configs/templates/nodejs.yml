box: ubuntu/trusty32
ip: 192.168.33.77
hostname: nodejs.dev
memory: 512
ports:
    - host: 80
      guest: 80
provision: |
  #####################################################
  # Setup webserver                                   #
  #####################################################

  if [ ! -d /vagrant/www ]; then
    mkdir -p /vagrant/www
    sudo chmod 755 /vagrant/www
  fi

  sudo chown -R www-data:www-data /vagrant/www

  sudo apt-get update

  sudo apt-get install -y nodejs npm mongodb build-essential mysql-server-5.5 mysql-client-5.5 git nodejs-legacy curl
  sudo npm install -g forever forever-service grunt less sass

  #####################################################
  # Generates default pages if needed                 #
  # (this can be replaced with code to download and   #
  # setup default NodeJS application)                 #
  #####################################################

  if [ ! "$(ls -A /vagrant/www)" ]; then
    cd /vagrant/www/
    touch .foreverignore

    curl -L -o main.js http://bit.ly/292rZbO

    touch /vagrant/www.log
    chmod 0666 /vagrant/www.log
    sudo ln -s /vagrant/www.log /var/log/www-default.log

    options='--verbose --workingDir /vagrant/www/ --sourceDir /vagrant/www/ --watchDirectory /vagrant/www/ --watch main.js'
    sudo forever-service install www-default --script main.js --foreverOptions " $options " --runAsUser vagrant
    sudo start www-default
  fi;

